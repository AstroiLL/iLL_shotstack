## Context

Текущая система валидации JSON (`check_json.py`) обеспечивает базовую проверку синтаксиса JSON, но не включает комплексную валидацию Shotstack Template структуры, проверки доступности файлов и валидации полей согласно API спецификациям. Это приводит к ошибкам сборки видео на поздних этапах и требует ручной отладки.

**Текущее состояние:**
- Базовая проверка JSON синтаксиса
- Отсутствие проверки требуемых полей Shotstack Template
- Нет проверки доступности медиафайлов
- Нет валидации значений полей (transitions, effects, filters)
- Валидация не интегрирована в основной рабочий процесс

**Ограничения:**
- Использование существующей архитектуры модуля `fast_clip/check/`
- Совместимость с существующими скриптами `convert_script.py` и `assemble.py`
- Соответствие Shotstack API спецификациям
- Минимальные внешние зависимости

## Goals / Non-Goals

**Goals:**
- Создать комплексную систему валидации Shotstack Template JSON
- Обеспечить проверку доступности медиафайлов перед сборкой
- Реализовать валидацию полей согласно Shotstack API спецификациям
- Интегрировать валидацию в конвертер и сборщик видео
- Предоставить понятные сообщения об ошибках и предложениях

**Non-Goals:**
- Изменение существующего Shotstack API
- Модификация формата Shotstack Template
- Создание новой системы хранения файлов
- Изменение логики сборки видео (только добавление валидации)

## Decisions

### 1. Архитектура валидатора на основе Pydantic моделей
**Решение:** Использовать Pydantic для структурированной валидации JSON
**Обоснование:** Pydantic обеспечивает автоматическую валидацию, понятные сообщения об ошибках и поддержку типов. Альтернатива - ручная валидация с JSON schema - потребует больше кода и обеспечит менее понятные ошибки.

### 2. Модульная структура валидации
**Решение:** Разделить валидацию на независимые модули (JSON структура, файлы, поля)
**Обоснование:** Облегчает тестирование, поддержку и расширение. Альтернатива - монолитный валидатор - был бы сложнее в поддержке и тестировании.

### 3. Интеграция через декораторы и wrapper функции
**Решение:** Обернуть существующие функции валидации без изменения их API
**Обоснование:** Сохраняет обратную совместимость. Альтернатива - изменение API существующих функций - могло бы сломать существующий код.

### 4. Кэширование результатов валидации файлов
**Решение:** Кэшировать результаты проверки доступности файлов в течение сессии
**Обоснование:** Избегает повторных проверок одних и тех же файлов. Альтернатива - проверка при каждом вызове - была бы менее эффективной.

## Risks / Trade-offs

**[Risk]** Увеличение времени выполнения из-за комплексной валидации
→ **Mitigation:** Опциональная валидация (--skip-validate флаг), кэширование результатов

**[Risk]** Сложность поддержания актуального списка валидных Shotstack полей
→ **Mitigation:** Автоматическая генерация констант из документации, регулярное обновление

**[Trade-off]** Дополнительная зависимость от Pydantic
→ **Trade-off accepted:** Pydantic уже используется в проекте, преимущества перевешивают издержки

**[Risk]** Ложные срабатывания при проверке файлов (проблемы с правами доступа)
→ **Mitigation:** Разделение ERROR/WARNING уровней, опциональная строгая проверка

## Migration Plan

1. **Этап 1:** Создание новых модулей валидации в `fast_clip/check/`
2. **Этап 2:** Интеграция валидации в `check.py` с сохранением обратной совместимости
3. **Этап 3:** Добавление валидации в `convert_script.py` и `assemble.py`
4. **Этап 4:** Обновление документации и примеров использования
5. **Этап 5:** Удаление устаревшего `check_json.py` после периода адаптации

**Rollback стратегия:** Сохранение существующих функций в течение переходного периода, возможность отката через флаг `--legacy-validation`

## Open Questions

1. **Уровень строгости валидации:** Какой уровень строгости установить по умолчанию для проверки полей? (ERROR vs WARNING)
2. **Производительность:** Какое максимальное время выполнения валидации приемлемо для больших проектов?
3. **Расширяемость:** Требуется ли поддержка пользовательских правил валидации в будущем?
4. **Интеграция с CI/CD:** Необходимо ли интегрировать валидацию в процессы непрерывной интеграции?